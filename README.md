# Курсовая работа

# Check list
- [ ] Автоматизированные процессы создания и управления
платформой:
  - [X] Ресурсы GCP
  - [X] Инфраструктура для CI/CD 
    - Поднят GitLab на отдельном kuber кластере
    - Настроен GitLAb-Ci c авто деплоем в другой "промышленный" кубер кластер (правда настроен он для одной ветке master, оставим и будем говорить, что у нас feature toggle или добавми ветвь )
  - [ ] Инфраструктура для сбора обратной связи (как думаете, что здесь имелось ввиду? Настроенные chart с prometheus?)

- [X] Использование практики IaC (Infrastructure as Code) для управления конфигурацией и инфраструктурой 
  - Настроены Dockerfile и описаны объекты Kubernets в yaml (правда, надо описать нормаьный Service для UI, а то до него снаружи не достучаться, может можно и https добавить), управляется все это с Chart-ов Helm-a
- [X] Настроен процесс CI/CD
- [X] Все, что имеет отношение к проекту хранится в Git (Кроме логинов и  паролей)
- [ ] Настроен процесс сбора обратной связи:
  - [ ] Мониторинг (сбор метрик, алертинг, визуализация)
  - [ ] Логирование (опционально)
  - [ ] Трейсинг (опционально)
  - [ ] ChatOps (опционально) 
- [ ] Документация:
  - [ ] README по работе с репозиторием
  - [ ] Описание приложения и его архитектуры
  - [ ] How to start?
  - [ ] CHANGELOG с описанием выполненной работы
  - [ ] Если работа в группе, то пункт включает автора изменений
## Простой запуск приложения в Docker контейнерах

1. Cобираем образ c тэгом `"docker build . -t asurov/name"`
2. Создаем сеть - пользовательский bridge`"docker network create --driver mynet"`
3. Запускаем контейнеры `"docker run -dit  --network kurs --name nm asurov/cntname"`, не забудем пробросить порты для ui приложения `"-p 80:8000"`, а также правильно проименовать сервисы mongo и rabitmq, чтобы приложения нашли их.
4. Проверяем в браузере
## Описываем контейнеры в kubernete объектах и helme
    
При ининциализации Tiller-a имет смысл не забыть дать ему собственный ServiceAccount.
ServiceAccount описан в tiller.yaml, загружаем в kubernetes:
kubectl apply -f tiller.yml
Инициализируем tiller:
helm init --service-account tiller

Для установки gitlaba нужно выполнить следующие команды:
Отключить RBAC для упрощения работы.
helm install --name gitlab . -f values.yaml
Узнать ip адрес:
kubectl get service -n nginx-ingress nginx
echo "35.234.78.177 gitlab-gitlab staging production” | sudo tee -a /etc/hosts
Репозиторий должен быть публичный иначе Ci не сможет выгрузить chart-s для helm и надо будет настраивать доступ по ssh (https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/ci/ssh_keys/README.md)
Чтобы сохранять контейнеры в hub.docker необходимо указать логин (CI_REGISTRY_USER) и пароль (CI_REGISTRY_PASSWORD) в переменных окружения gitlab ci.
Для деплой в другой кластер необходимо получить service acccunt GCP в json формате, зашифровать его base64 и сохранить в переменной service_account в gitlab-ci.

